name: Deploy Documentation

on:
  push:
    branches: [ main ]
    paths:
      - 'docs/**'
      - 'README.md'
      - 'CLAUDE.md'

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy-docs:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Pages
      uses: actions/configure-pages@v3

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'

    - name: Install dependencies
      run: npm ci

    - name: Generate documentation site
      run: |
        mkdir -p _site
        cp README.md _site/index.md
        cp CLAUDE.md _site/methodology.md
        cp -r docs/* _site/

        # Create basic HTML wrapper
        cat > _site/index.html << 'EOF'
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>VERSATIL SDLC Framework</title>
            <style>
                body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
                .hero { text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 60px 20px; border-radius: 10px; margin-bottom: 40px; }
                .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 40px 0; }
                .feature { padding: 20px; border: 1px solid #e1e5e9; border-radius: 8px; }
                .stats { display: flex; justify-content: space-around; margin: 40px 0; }
                .stat { text-align: center; }
                .stat h3 { color: #667eea; margin: 0; font-size: 2em; }
            </style>
        </head>
        <body>
            <div class="hero">
                <h1>üöÄ VERSATIL SDLC Framework</h1>
                <p>AI-Native Development Platform with BMAD Methodology</p>
                <p>Zero Context Loss ‚Ä¢ 6 Specialized Agents ‚Ä¢ 340% Faster Development</p>
            </div>

            <div class="stats">
                <div class="stat">
                    <h3>97.3%</h3>
                    <p>Deployment Success</p>
                </div>
                <div class="stat">
                    <h3>340%</h3>
                    <p>Faster Development</p>
                </div>
                <div class="stat">
                    <h3>6</h3>
                    <p>BMAD Agents</p>
                </div>
                <div class="stat">
                    <h3>80%</h3>
                    <p>Test Coverage</p>
                </div>
            </div>

            <div class="features">
                <div class="feature">
                    <h3>ü§ñ Auto-Agent Activation</h3>
                    <p>6 specialized BMAD agents automatically activate based on file patterns and project context.</p>
                </div>
                <div class="feature">
                    <h3>üîç Enhanced Context Validation</h3>
                    <p>Validates task clarity before execution, requesting clarification when needed.</p>
                </div>
                <div class="feature">
                    <h3>üö® Emergency Response</h3>
                    <p>Automatic detection and cascaded agent response for critical development situations.</p>
                </div>
                <div class="feature">
                    <h3>üìä Quality Gates</h3>
                    <p>Enforces 80% test coverage, performance budgets, and security scanning.</p>
                </div>
            </div>

            <h2>üìñ Documentation</h2>
            <ul>
                <li><a href="methodology.md">BMAD Methodology Guide</a></li>
                <li><a href="setup/README.md">Setup & Installation</a></li>
                <li><a href="agents/README.md">Agent Configuration</a></li>
                <li><a href="api/README.md">API Reference</a></li>
            </ul>

            <h2>üöÄ Quick Start</h2>
            <pre><code>npm install -g versatil-sdlc-framework
versatil init
versatil health</code></pre>

            <p><strong>GitHub:</strong> <a href="https://github.com/MiraclesGIT/versatil-sdlc-framework">MiraclesGIT/versatil-sdlc-framework</a></p>
        </body>
        </html>
        EOF

    - name: Upload artifact
      uses: actions/upload-pages-artifact@v2
      with:
        path: '_site'

    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v2